<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NOIR - Premium Faceless Content</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;1,400&family=Lora:wght@400;500&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Lora', Georgia, serif; background: #FAF8F5; color: #4A4A4A; }
    .hidden { display: none !important; }
    
    .nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 32px 64px;
      border-bottom: 1px solid rgba(74, 74, 74, 0.1);
      background: white;
    }
    
    .logo-container { display: flex; align-items: center; gap: 12px; cursor: pointer; }
    .logo-dot { width: 8px; height: 8px; background: #D4AF37; border-radius: 50%; }
    .logo { font-family: 'Playfair Display', serif; font-size: 32px; color: #2D1B3D; letter-spacing: 0.12em; }
    
    .budget-info {
      position: fixed;
      top: 16px;
      right: 16px;
      background: white;
      padding: 12px 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      font-family: 'Inter', sans-serif;
      font-size: 12px;
      z-index: 1001;
    }
    
    .content { padding: 64px; max-width: 1400px; margin: 0 auto; }
    .title { font-family: 'Playfair Display', serif; font-size: 52px; color: #2D1B3D; margin-bottom: 24px; }
    
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 20px;
      margin-top: 48px;
    }
    
    .card {
      background: white;
      border: 2px solid #E5E5E5;
      border-radius: 8px;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .card:hover { border-color: #D4AF37; transform: translateY(-2px); }
    .card.selected { border-color: #D4AF37; box-shadow: 0 8px 24px rgba(212, 175, 55, 0.3); }
    
    .swatch { height: 140px; position: relative; }
    .card.selected .swatch::after {
      content: '✓';
      position: absolute;
      top: 8px;
      right: 8px;
      width: 28px;
      height: 28px;
      background: #D4AF37;
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }
    
    .card-body { padding: 16px; }
    .card-title { font-family: 'Inter', sans-serif; font-size: 15px; font-weight: 500; color: #2D1B3D; margin-bottom: 4px; }
    .card-desc { font-size: 11px; color: #8A8A8A; }
    
    .btn {
      font-family: 'Inter', sans-serif;
      font-size: 13px;
      font-weight: 500;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      padding: 18px 44px;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 48px;
    }
    
    .btn-primary { background: #3D2952; color: #FAF8F5; }
    .btn-primary:hover { background: #2D1B3D; transform: translateY(-2px); }
    .btn-secondary { background: transparent; color: #D4AF37; border: 2px solid #D4AF37; }
    
    .spinner {
      width: 80px;
      height: 80px;
      border: 4px solid #E5E5E5;
      border-top-color: #D4AF37;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 24px;
    }
    
    @keyframes spin { to { transform: rotate(360deg); } }
    
    .center { text-align: center; padding: 80px 20px; }
    
    .progress-bar {
      width: 100%;
      max-width: 400px;
      height: 8px;
      background: #E5E5E5;
      border-radius: 4px;
      margin: 24px auto;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #D4AF37, #B8941F);
      transition: width 0.3s ease;
      border-radius: 4px;
    }
  </style>
</head>

<body>
  <div class="budget-info">
    <div style="color: #8A8A8A; margin-bottom: 4px;">Video Cost</div>
    <div style="font-weight: 600; color: #2D1B3D;">$0.50 per video</div>
  </div>

  <nav class="nav">
    <div class="logo-container" onclick="goToLanding()">
      <div class="logo-dot"></div>
      <div class="logo">NOIR</div>
      <div class="logo-dot"></div>
    </div>
  </nav>

  <div id="page-landing" class="content">
    <div class="center">
      <div style="font-family: 'Inter', sans-serif; font-size: 12px; letter-spacing: 0.2em; text-transform: uppercase; color: #A0A0A0; margin-bottom: 40px;">
        PREMIUM FACELESS CONTENT
      </div>
      
      <h1 style="font-family: 'Playfair Display', serif; font-size: 72px; line-height: 1.2; margin-bottom: 40px;">
        <div style="color: #2D1B3D;">Elevate The</div>
        <div style="color: #D4AF37; font-style: italic;">Aesthetic Vision.</div>
      </h1>
      
      <p style="font-size: 19px; line-height: 1.8; color: #6A6A6A; max-width: 650px; margin: 0 auto 56px;">
        Cinematic visuals calibrated to your specific <span style="color: #D4AF37; font-style: italic;">melanin-rich identity</span>. 
        NOIR synthesizes deep intelligence with ultra-realistic textures.
      </p>
      
      <button class="btn btn-primary" onclick="goToStudio()">Initialize Studio</button>
    </div>
  </div>

  <div id="page-tones" class="content hidden">
    <h2 class="title">Select Your Skin Tone</h2>
    <p style="font-size: 18px; color: #6A6A6A; margin-bottom: 24px;">
      Choose the skin tone that best represents you.
    </p>
    <div class="grid" id="tones-grid"></div>
    <div style="text-align: center;">
      <button class="btn btn-primary hidden" id="btn-to-templates" onclick="goToTemplates()">Continue to Templates</button>
    </div>
  </div>

  <div id="page-templates" class="content hidden">
    <button onclick="goToStudio()" style="margin-bottom: 24px; background: none; border: none; color: #8A8A8A; cursor: pointer; font-size: 14px;">← Back</button>
    <h2 class="title">Choose Your Template</h2>
    <div style="margin-bottom: 32px; padding: 16px; background: #FAF8F5; border: 1px solid rgba(212, 175, 55, 0.2); border-radius: 8px; display: inline-flex; align-items: center; gap: 12px;">
      <div id="tone-swatch" style="width: 32px; height: 32px; border-radius: 50%; border: 2px solid #D4AF37;"></div>
      <span style="font-size: 14px; color: #6A6A6A;"><strong id="tone-name">-</strong></span>
    </div>
    <div class="grid" id="templates-grid"></div>
    <div style="text-align: center;">
      <button class="btn btn-primary hidden" id="btn-generate" onclick="generateVideo()">Generate Video ($0.50)</button>
    </div>
  </div>

  <div id="page-generating" class="content hidden">
    <div class="center">
      <div class="spinner"></div>
      <h2 class="title" style="font-size: 40px;">Generating Your Video</h2>
      <p style="font-size: 18px; color: #6A6A6A; margin: 24px 0;">This takes approximately 2-3 minutes. Please wait...</p>
      <div class="progress-bar"><div class="progress-fill" id="progress-fill" style="width: 0%"></div></div>
      <div id="status-text" style="font-size: 14px; color: #8A8A8A; margin-top: 24px;">Initializing...</div>
    </div>
  </div>

  <div id="page-complete" class="content hidden">
    <div class="center">
      <div style="font-size: 64px; color: #D4AF37; margin-bottom: 24px;">✓</div>
      <h2 class="title" style="font-size: 40px;">Your Video Is Ready</h2>
      <video id="result-video" style="width: 300px; max-width: 100%; margin: 48px auto; border-radius: 8px; display: block;" controls></video>
      <div style="display: flex; gap: 20px; justify-content: center;">
        <a id="download-link" class="btn btn-primary" download="noir-video.mp4">Download Video</a>
        <button class="btn btn-secondary" onclick="resetApp()">Create Another</button>
      </div>
    </div>
  </div>

  <div id="page-error" class="content hidden">
    <div class="center">
      <div style="font-size: 64px; color: #DC3545; margin-bottom: 24px;">✗</div>
      <h2 class="title" style="font-size: 40px;">Something Went Wrong</h2>
      <p id="error-message" style="font-size: 18px; color: #6A6A6A; margin: 24px 0;">An error occurred.</p>
      <button class="btn btn-primary" onclick="resetApp()">Try Again</button>
    </div>
  </div>

  <script>
    var TONES = [
      { id: 1, hex: '#FFE4D6', name: 'Fair Cool', desc: 'Porcelain with pink undertones' },
      { id: 2, hex: '#F7D7C4', name: 'Fair Warm', desc: 'Ivory with golden undertones' },
      { id: 3, hex: '#F5E1D3', name: 'Fair Neutral', desc: 'Balanced beige tones' },
      { id: 4, hex: '#D4A574', name: 'Medium Cool', desc: 'Tan with rose undertones' },
      { id: 5, hex: '#C58D5D', name: 'Medium Warm', desc: 'Caramel with golden undertones' },
      { id: 6, hex: '#9D7A54', name: 'Medium Olive', desc: 'Olive with green undertones' },
      { id: 7, hex: '#8D5524', name: 'Tan', desc: 'Rich bronze tones' },
      { id: 8, hex: '#654321', name: 'Deep Cool', desc: 'Chocolate with cool undertones' },
      { id: 9, hex: '#5C3317', name: 'Deep Warm', desc: 'Mahogany with warm undertones' },
      { id: 10, hex: '#4A2511', name: 'Deep Rich', desc: 'Espresso tones' },
      { id: 11, hex: '#3D2817', name: 'Very Deep Cool', desc: 'Dark chocolate with cool undertones' },
      { id: 12, hex: '#1C0F0A', name: 'Very Deep Rich', desc: 'Deep ebony tones' }
    ];

    var TEMPLATES = [
      { id: 1, name: 'Morning Coffee', desc: 'Pouring coffee into ceramic mug', prompt: 'Cinematic slow-motion shot of hands pouring fresh coffee into cream ceramic mug on marble countertop, morning golden hour light streaming through window, steam rising elegantly, luxury lifestyle aesthetic' },
      { id: 2, name: 'Desk Work', desc: 'Writing in journal', prompt: 'Close-up cinematic shot of hands writing in elegant leather journal at minimalist organized desk, natural window light, small potted plant in background, professional productivity aesthetic' },
      { id: 3, name: 'Self-Care Bath', desc: 'Lighting candle', prompt: 'Elegant hands lighting white candle beside modern bathtub with rose petals, soft warm golden lighting, spa-like atmosphere, luxury wellness aesthetic' },
      { id: 4, name: 'Plant Care', desc: 'Watering plants', prompt: 'Hands gently watering lush indoor plants in terracotta pots on wooden shelf, natural morning light, botanical aesthetic, peaceful atmosphere' },
      { id: 5, name: 'Reading Moment', desc: 'Turning pages', prompt: 'Close-up of hands turning pages of vintage hardcover book in cozy reading nook, warm afternoon light, intellectual aesthetic' },
      { id: 6, name: 'Tea Ritual', desc: 'Preparing tea', prompt: 'Elegant hands pouring hot water into clear glass teapot with loose leaf tea, zen minimalist setting, steam visible, calm aesthetic' },
      { id: 7, name: 'Jewelry Moment', desc: 'Gold necklace', prompt: 'Close-up of hands fastening delicate gold necklace, soft bedroom lighting, luxury fashion aesthetic' },
      { id: 8, name: 'Meal Prep', desc: 'Chopping vegetables', prompt: 'Hands chopping fresh colorful vegetables on rustic wooden cutting board, bright natural kitchen light, culinary aesthetic' },
      { id: 9, name: 'Skincare Ritual', desc: 'Applying products', prompt: 'Hands applying luxury skincare product at marble vanity with elegant bottles, soft flattering light, premium beauty aesthetic' },
      { id: 10, name: 'Workspace Setup', desc: 'Organizing desk', prompt: 'Hands arranging minimalist workspace with MacBook and leather journal, natural window light, professional productivity aesthetic' }
    ];

    var selectedTone = null;
    var selectedTemplate = null;
    var currentTaskId = null;
    var pollInterval = null;

    renderTones();
    renderTemplates();

    function renderTones() {
      var html = '';
      for (var i = 0; i < TONES.length; i++) {
        var t = TONES[i];
        html += '<div class="card" onclick="selectTone(' + t.id + ')">' +
          '<div class="swatch" style="background: ' + t.hex + ';"></div>' +
          '<div class="card-body">' +
            '<div class="card-title">' + t.name + '</div>' +
            '<div class="card-desc">' + t.desc + '</div>' +
          '</div>' +
        '</div>';
      }
      document.getElementById('tones-grid').innerHTML = html;
    }

    function renderTemplates() {
      var html = '';
      for (var i = 0; i < TEMPLATES.length; i++) {
        var t = TEMPLATES[i];
        html += '<div class="card" onclick="selectTemplate(' + t.id + ')">' +
          '<div class="swatch" style="background: linear-gradient(135deg, rgba(45,27,61,0.1), rgba(212,175,55,0.1));"></div>' +
          '<div class="card-body">' +
            '<div class="card-title">' + t.name + '</div>' +
            '<div class="card-desc">' + t.desc + '</div>' +
          '</div>' +
        '</div>';
      }
      document.getElementById('templates-grid').innerHTML = html;
    }

    function selectTone(id) {
      for (var i = 0; i < TONES.length; i++) {
        if (TONES[i].id === id) {
          selectedTone = TONES[i];
          break;
        }
      }
      var cards = document.querySelectorAll('#tones-grid .card');
      for (var i = 0; i < cards.length; i++) { cards[i].classList.remove('selected'); }
      event.currentTarget.classList.add('selected');
      document.getElementById('btn-to-templates').classList.remove('hidden');
    }

    function selectTemplate(id) {
      for (var i = 0; i < TEMPLATES.length; i++) {
        if (TEMPLATES[i].id === id) {
          selectedTemplate = TEMPLATES[i];
          break;
        }
      }
      var cards = document.querySelectorAll('#templates-grid .card');
      for (var i = 0; i < cards.length; i++) { cards[i].classList.remove('selected'); }
      event.currentTarget.classList.add('selected');
      document.getElementById('btn-generate').classList.remove('hidden');
    }

    function goToLanding() {
      hideAll();
      document.getElementById('page-landing').classList.remove('hidden');
    }

    function goToStudio() {
      hideAll();
      document.getElementById('page-tones').classList.remove('hidden');
    }

    function goToTemplates() {
      hideAll();
      document.getElementById('page-templates').classList.remove('hidden');
      document.getElementById('tone-name').textContent = selectedTone.name;
      document.getElementById('tone-swatch').style.background = selectedTone.hex;
    }

    function generateVideo() {
      hideAll();
      document.getElementById('page-generating').classList.remove('hidden');
      document.getElementById('progress-fill').style.width = '5%';
      document.getElementById('status-text').textContent = 'Connecting to video generator...';
      
      var requestBody = {
        prompt: selectedTemplate.prompt,
        skinTone: selectedTone.name,
        template: selectedTemplate.name
      };

      fetch('/.netlify/functions/generate', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(requestBody)
      })
      .then(function(response) {
        return response.json();
      })
      .then(function(data) {
        if (data.error) {
          showError(data.error);
          return;
        }
        currentTaskId = data.taskId;
        document.getElementById('progress-fill').style.width = '15%';
        document.getElementById('status-text').textContent = 'Video generation started...';
        startPolling();
      })
      .catch(function(error) {
        showError('Failed to start video generation: ' + error.message);
      });
    }

    function startPolling() {
      var progress = 15;
      pollInterval = setInterval(function() {
        fetch('/.netlify/functions/status?taskId=' + currentTaskId)
        .then(function(response) {
          return response.json();
        })
        .then(function(data) {
          if (data.error) {
            clearInterval(pollInterval);
            showError(data.error);
            return;
          }

          if (data.progress) {
            progress = Math.max(progress, data.progress);
          } else {
            progress = Math.min(progress + 5, 90);
          }
          document.getElementById('progress-fill').style.width = progress + '%';

          if (data.status === 'SUCCEEDED' && data.videoUrl) {
            clearInterval(pollInterval);
            document.getElementById('progress-fill').style.width = '100%';
            document.getElementById('status-text').textContent = 'Complete!';
            setTimeout(function() {
              showComplete(data.videoUrl);
            }, 500);
          } else if (data.status === 'FAILED') {
            clearInterval(pollInterval);
            showError('Video generation failed. Please try again.');
          } else {
            document.getElementById('status-text').textContent = 'Generating your video... ' + progress + '%';
          }
        })
        .catch(function(error) {
          console.log('Polling error:', error);
        });
      }, 5000);
    }

    function showComplete(videoUrl) {
      hideAll();
      document.getElementById('page-complete').classList.remove('hidden');
      document.getElementById('result-video').src = videoUrl;
      document.getElementById('download-link').href = videoUrl;
    }

    function showError(message) {
      hideAll();
      document.getElementById('page-error').classList.remove('hidden');
      document.getElementById('error-message').textContent = message;
    }

    function resetApp() {
      if (pollInterval) {
        clearInterval(pollInterval);
      }
      selectedTone = null;
      selectedTemplate = null;
      currentTaskId = null;
      var cards = document.querySelectorAll('.card');
      for (var i = 0; i < cards.length; i++) { cards[i].classList.remove('selected'); }
      document.getElementById('btn-to-templates').classList.add('hidden');
      document.getElementById('btn-generate').classList.add('hidden');
      document.getElementById('progress-fill').style.width = '0%';
      goToStudio();
    }

    function hideAll() {
      document.getElementById('page-landing').classList.add('hidden');
      document.getElementById('page-tones').classList.add('hidden');
      document.getElementById('page-templates').classList.add('hidden');
      document.getElementById('page-generating').classList.add('hidden');
      document.getElementById('page-complete').classList.add('hidden');
      document.getElementById('page-error').classList.add('hidden');
    }
  </script>
</body>
</html>